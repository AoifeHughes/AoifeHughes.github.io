<!doctype html><html lang=en-gb>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta itemprop=name content="Visualising World Temperature Data">
<meta itemprop=description content="I like to start with the end result of a project, just to show if this is what you&rsquo;re looking for before you read:
 Some caveats:
 These data are limited to what a 10 second google search yielded (I found it on Kaggle) Data are approximately matched to country codes in order to streamline things Year range of data is very limited Code is written in an obtuse way in order to make clear what is happening  There is little need for multiple lists matching data codes for example   Some countries are missing data, easily solved with better country code matching and a better data source  Libraries required for this:"><meta itemprop=datePublished content="2021-11-04T00:57:10+01:00">
<meta itemprop=dateModified content="2021-11-04T00:57:10+01:00">
<meta itemprop=wordCount content="411">
<meta itemprop=keywords content><meta property="og:title" content="Visualising World Temperature Data">
<meta property="og:description" content="I like to start with the end result of a project, just to show if this is what you&rsquo;re looking for before you read:
 Some caveats:
 These data are limited to what a 10 second google search yielded (I found it on Kaggle) Data are approximately matched to country codes in order to streamline things Year range of data is very limited Code is written in an obtuse way in order to make clear what is happening  There is little need for multiple lists matching data codes for example   Some countries are missing data, easily solved with better country code matching and a better data source  Libraries required for this:">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/temp-data/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-04T00:57:10+01:00">
<meta property="article:modified_time" content="2021-11-04T00:57:10+01:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Visualising World Temperature Data">
<meta name=twitter:description content="I like to start with the end result of a project, just to show if this is what you&rsquo;re looking for before you read:
 Some caveats:
 These data are limited to what a 10 second google search yielded (I found it on Kaggle) Data are approximately matched to country codes in order to streamline things Year range of data is very limited Code is written in an obtuse way in order to make clear what is happening  There is little need for multiple lists matching data codes for example   Some countries are missing data, easily solved with better country code matching and a better data source  Libraries required for this:">
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<title>Visualising World Temperature Data</title>
<link rel=stylesheet href=/css/style.min.037b6ee8f8c1baab6a3d0a9da11c3ff18a7552471f16c59fd98538d5ce99208b.css integrity="sha256-A3tu6PjBuqtqPQqdoRw/8Yp1UkcfFsWf2YU41c6ZIIs=" crossorigin=anonymous>
</head>
<body id=page>
<header id=site-header class="animated slideInUp">
<div class="hdr-wrapper section-inner">
<div class=hdr-left>
<div class=site-branding>
<a href=/>Aoife's Blog</a>
</div>
<nav class="site-nav hide-in-mobile">
<a href=/posts/>Posts</a>
<a href=/randomsky/>Skyrim Randomiser</a>
</nav>
</div>
<div class="hdr-right hdr-icons">
<span class="hdr-social hide-in-mobile"><a href=https://www.twitch.tv/aoifehughes__ target=_blank rel="noopener me" title=Twitch><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2H3v16h5v4l4-4h5l4-4V2zm-10 9V7m5 4V7"/></svg></a><a href=https://www.youtube.com/channel/UCoj4IBtY8F9zcbApICOCuqw target=_blank rel="noopener me" title=Youtube><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.54 6.42a2.78 2.78.0 00-1.94-2C18.88 4 12 4 12 4s-6.88.0-8.6.46a2.78 2.78.0 00-1.94 2A29 29 0 001 11.75a29 29 0 00.46 5.33A2.78 2.78.0 003.4 19c1.72.46 8.6.46 8.6.46s6.88.0 8.6-.46a2.78 2.78.0 001.94-2 29 29 0 00.46-5.25 29 29 0 00-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/></svg></a><a href=https://twitter.com/AoifeH__ target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://instagram.com/Aoife.1.Hughes target=_blank rel="noopener me" title=Instagram><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a><a href=https://github.com/AoifeHughes target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
</div>
</div>
</header>
<div id=mobile-menu class="animated fast">
<ul>
<li><a href=/posts/>Posts</a></li>
<li><a href=/randomsky/>Skyrim Randomiser</a></li>
</ul>
</div>
<main class="site-main section-inner animated fadeIn faster">
<article class=thin>
<header class=post-header>
<div class=post-meta><span>Nov 4, 2021</span></div>
<h1>Visualising World Temperature Data</h1>
</header>
<div class=content>
<p>I like to start with the end result of a project, just to show if this is what you&rsquo;re looking for before you read:</p>
<iframe src=/subfiles/temp.html style=height:700px;width:100%></iframe>
<p>Some caveats:</p>
<ul>
<li>These data are limited to what a 10 second google search yielded (I found it on Kaggle)</li>
<li>Data are approximately matched to country codes in order to streamline things</li>
<li>Year range of data is very limited</li>
<li>Code is written in an obtuse way in order to make clear what is happening
<ul>
<li>There is little need for multiple lists matching data codes for example</li>
</ul>
</li>
<li>Some countries are missing data, easily solved with better country code matching and a better data source</li>
</ul>
<p>Libraries required for this:</p>
<ul>
<li>pandas</li>
<li>plotly</li>
<li>numpy (probably)</li>
<li>pycountry (because data source lacked these codes that plotly uses)</li>
</ul>
<p>With proper data, this should really be a country agnostic plot. I&rsquo;ll update this when I have time to find data&mldr;</p>
<p>Okay, so this pretty much works like any data analysis/visualization. First we load in the data,</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> plotly.graph_objects <span style=color:#66d9ef>as</span> go
<span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd

df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;temp_data.csv&#39;</span>)<span style=color:#f92672>.</span>melt(id_vars<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;year&#39;</span>], var_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;country&#39;</span>, value_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;temperature&#39;</span>)</code></pre></div>
<p>, because the data are column based we just have to melt it so that each country has a year and a temperature per row.</p>
<p>Using pycountry we can create a dictionary to match up country names in our data to their codes used in plotting per country,</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> pycountry
keys <span style=color:#f92672>=</span> [list(pycountry<span style=color:#f92672>.</span>countries)[i]<span style=color:#f92672>.</span>alpha_3 <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(pycountry<span style=color:#f92672>.</span>countries))]
names <span style=color:#f92672>=</span> [list(pycountry<span style=color:#f92672>.</span>countries)[i]<span style=color:#f92672>.</span>name <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(pycountry<span style=color:#f92672>.</span>countries))]
conv <span style=color:#f92672>=</span> { v:k <span style=color:#66d9ef>for</span> k,v <span style=color:#f92672>in</span> zip(keys,names) }
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>match_name</span>(x):
    <span style=color:#66d9ef>try</span>:
        <span style=color:#66d9ef>return</span> conv[x]
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyError</span> <span style=color:#66d9ef>as</span> e:
        <span style=color:#66d9ef>for</span>  n <span style=color:#f92672>in</span> names:
            <span style=color:#66d9ef>if</span> x <span style=color:#f92672>in</span> n:
                <span style=color:#66d9ef>return</span> conv[n]
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;N/A&#39;</span>
df[<span style=color:#e6db74>&#39;codes&#39;</span>] <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>apply(<span style=color:#66d9ef>lambda</span> x: match_name(x[<span style=color:#e6db74>&#39;country&#39;</span>]), axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)</code></pre></div>
<p>Finally, using plotly sliders, we can just create a Choropleth plot for each year, set it to not being visable and create a master figure out of them all.</p>
<p>And thats that.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>years <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;year&#39;</span>]<span style=color:#f92672>.</span>unique()
years<span style=color:#f92672>.</span>sort()
years_sliders <span style=color:#f92672>=</span> []

<span style=color:#66d9ef>for</span> year <span style=color:#f92672>in</span> years:
    tdf <span style=color:#f92672>=</span> df[df[<span style=color:#e6db74>&#39;year&#39;</span>] <span style=color:#f92672>==</span> year]

    years_sliders<span style=color:#f92672>.</span>append(go<span style=color:#f92672>.</span>Choropleth(
        visible<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
        locations <span style=color:#f92672>=</span> tdf[<span style=color:#e6db74>&#39;codes&#39;</span>],
        z <span style=color:#f92672>=</span> tdf[<span style=color:#e6db74>&#39;temperature&#39;</span>],
        text <span style=color:#f92672>=</span> tdf[<span style=color:#e6db74>&#39;country&#39;</span>],
        colorscale <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RdBu&#39;</span>,
        autocolorscale<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
        reversescale<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
        marker_line_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;darkgray&#39;</span>,
        marker_line_width<span style=color:#f92672>=</span><span style=color:#ae81ff>0.5</span>,
        colorbar_tickprefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;C&#39;</span>,
        colorbar_title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Temperature&#39;</span>,
        zmin<span style=color:#f92672>=-</span>df[<span style=color:#e6db74>&#39;temperature&#39;</span>]<span style=color:#f92672>.</span>min(), zmax<span style=color:#f92672>=</span>df[<span style=color:#e6db74>&#39;temperature&#39;</span>]<span style=color:#f92672>.</span>max()
    ))

fig <span style=color:#f92672>=</span> go<span style=color:#f92672>.</span>Figure(data<span style=color:#f92672>=</span>years_sliders)

steps <span style=color:#f92672>=</span> []
<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(years)):
    step <span style=color:#f92672>=</span> dict(
        method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;update&#34;</span>,
        args<span style=color:#f92672>=</span>[{<span style=color:#e6db74>&#34;visible&#34;</span>: [<span style=color:#66d9ef>False</span>] <span style=color:#f92672>*</span> len(fig<span style=color:#f92672>.</span>data)},
              {<span style=color:#e6db74>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Year: &#34;</span> <span style=color:#f92672>+</span> str(years[i])}],
              label<span style=color:#f92672>=</span>str(years[i])  <span style=color:#75715e># layout attribute</span>
    )
    step[<span style=color:#e6db74>&#34;args&#34;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#34;visible&#34;</span>][i] <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>  <span style=color:#75715e># Toggle i&#39;th trace to &#34;visible&#34;</span>
    steps<span style=color:#f92672>.</span>append(step)

sliders <span style=color:#f92672>=</span> [dict(
    active<span style=color:#f92672>=</span>len(years),
    currentvalue<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;prefix&#34;</span>: <span style=color:#e6db74>&#34;Steps: &#34;</span>},
    pad<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;t&#34;</span>: <span style=color:#ae81ff>50</span>},
    steps<span style=color:#f92672>=</span>steps,
)]

geo<span style=color:#f92672>=</span>dict(
        showframe<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
        showcoastlines<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
        projection_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;orthographic&#39;</span>
    )
fig<span style=color:#f92672>.</span>update_layout(
    sliders<span style=color:#f92672>=</span>sliders,
    geo<span style=color:#f92672>=</span>geo
)
fig<span style=color:#f92672>.</span>data[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>visible <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>

fig<span style=color:#f92672>.</span>show()</code></pre></div>
</div>
<hr class=post-end>
<footer class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>411 Words</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-11-03 23:57 +0000</p>
</footer>
</article>
<div class="post-nav thin">
<a class=prev-post href=/posts/narrow-escape/>
<span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Narrow Escape Visualization</span>
</a>
</div>
<div id=comments class=thin>
</div>
</main>
<footer id=site-footer class="section-inner thin animated fadeIn faster">
<p>&copy; 2021 <a href=/>Aoife Hughes</a></p>
<p>
Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a>
</p>
</footer>
<script src=/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin=anonymous></script>
</body>
</html>